!function($){function a(a){return{pick:{id:a,label:"点击选择图片",multiple:!1},resize:!1,swf:"..//build/lib/webuploader/Uploader.swf",server:"",accept:{title:"Images",extensions:"gif,jpg,jpeg,bmp,png",mimeTypes:"image/*"},thumb:{width:150,height:150,quality:70,allowMagnify:!0,crop:!0,type:"image/jpeg"},method:"POST",server:"",sendAsBinary:!1,chunked:!0,chunkSize:524288,fileNumLimit:1,fileSizeLimit:5242880,fileSingleSizeLimit:5242880}}function b(a){return new WebUploader.Uploader(a)}function c(a,b,c){a>=100?(a+="%",c=c||"上传完成"):(a+="%",c=c||a);var d=b.find(".diyProgress"),e=b.find(".diyProgressText");d.width(a),e.text(c)}function d(a,b,c){c.removeFile(b),a.siblings("li").length<=0?a.parents(".parentFileBox").remove():a.remove()}function e(a,b,c){var e=b.id,g=a.next(".parentFileBox");if(g.length<=0){var h='<div class="parentFileBox"> \t\t\t\t\t\t<ul class="fileBoxUl"></ul>\t\t\t\t\t</div>';a.after(h),g=a.next(".parentFileBox")}if(g.find(".diyButton").length<=0){var h='<div class="diyButton"> \t\t\t\t\t\t<a class="diyStart" href="javascript:void(0)">开始上传</a> \t\t\t\t\t\t<a class="diyCancelAll" href="javascript:void(0)">全部取消</a> \t\t\t\t\t</div>';g.append(h);var i=g.find(".diyStart"),j=g.find(".diyCancelAll"),k=function(){c.upload(),i.text("暂停上传").one("click",function(){c.stop(),$(this).text("继续上传").one("click",function(){k()})})};i.one("click",k),j.bind("click",function(){var a=c.getFiles("queued");$.each(a,function(a,b){d($("#fileBox_"+b.id),b.id,c)})})}var l='<li id="fileBox_'+e+'" class="diyUploadHover"> \t\t\t\t\t<div class="viewThumb"></div> \t\t\t\t\t<div class="diyCancel"></div> \t\t\t\t\t<div class="diySuccess"></div> \t\t\t\t\t<div class="diyFileName">'+b.name+'</div>\t\t\t\t\t<div class="diyBar"> \t\t\t\t\t\t\t<div class="diyProgress"></div> \t\t\t\t\t\t\t<div class="diyProgressText">0%</div> \t\t\t\t\t</div> \t\t\t\t</li>';g.children(".fileBoxUl").append(l);var m=210*$(".fileBoxUl>li").length,n=a.parent().width();m=n>m?m:n,g.width(m);var o=g.find("#fileBox_"+e);o.children(".diyCancel").one("click",function(){d($(this).parent("li"),e,c)});if("image"!=b.type.split("/")[0]){var p=f(b.name.split(".").pop());return void o.addClass(p)}c.makeThumb(b,function(a,b){a||o.find(".viewThumb").append('<img src="'+b+'" >')})}function f(a){var b={};return b.pdf="pdf",b.zip="zip",b.rar="rar",b.csv="csv",b.doc="doc",b.xls="xls",b.xlsx="xls",b.txt="txt",(b=b[a]||"txt")+"_diy_bg"}$.fn.extend({diyUpload:function(d,f){if("object"!=typeof d)return void alert("参数错误!");var g=$(this),h=g.attr("id");if(d.url&&(d.server=d.url,delete d.url),d.success){var i=d.success;delete d.success}if(d.error){var j=d.error;delete d.error}$.each(a("#"+h),function(a,b){d[a]=d[a]||b}),d.buttonText&&(d.pick.label=d.buttonText,delete d.buttonText);var k=b(d);if(!WebUploader.Uploader.support())return alert(" 上传组件不支持您的浏览器！"),!1;k.on("fileQueued",function(a){e(g,a,k)}),k.on("uploadProgress",function(a,b){var d=$("#fileBox_"+a.id),e=d.find(".diyBar");e.show(),b*=100,c(b.toFixed(2),e)}),k.on("uploadFinished",function(){g.next(".parentFileBox").children(".diyButton").remove()}),k.on("uploadAccept",function(a,b){f&&f(b)}),k.on("uploadSuccess",function(a,b){var c=$("#fileBox_"+a.id),d=c.find(".diyBar");c.removeClass("diyUploadHover"),d.fadeOut(1e3,function(){c.children(".diySuccess").show()}),i&&i(b)}),k.on("uploadError",function(a,b){alert(b),c(0,$("#fileBox_"+a.id).find(".diyBar"),"上传失败!");var d="上传失败! 文件:"+a.name+" 错误码:"+b;j&&j(d)}),k.on("error",function(a){var b="";switch(a){case"F_DUPLICATE":b="该文件已经被选择了!";break;case"Q_EXCEED_NUM_LIMIT":b="上传文件数量超过限制!";break;case"F_EXCEED_SIZE":b="文件大小超过限制!";break;case"Q_EXCEED_SIZE_LIMIT":b="所有文件总大小超过限制!";break;case"Q_TYPE_DENIED":b="文件类型不正确或者是空文件!";break;case"F_CANNOT_REPEAT":b="文件不能重复!";break;default:b="未知错误!"}alert(b)})}})}(jQuery);